%Input variables 
%Distance between carrot roots in a row 
%Distance between carrot roots in a row on a ridge 
%Heading height of carrot root 
%Height of the head above the soil surface 
%Carrot root yield per 9 m2 area
%Weight of a single carrot root 
%Diameter of a single carrot root
%Length of a single carrot root 
%Angular speed of the disc
%Progressive speed in rotary motion
%Height of disc above ridge surface
%Machine progressive speed

data = [0.033	0.063	0.009	0.060	86694	0.276	0.045	0.180;
        0.034	0.066	0.044	0.005	91536	0.170	0.025	0.198;
0.028	0.035	0.017	0.001	86560	0.299	0.049	0.152;
0.024	0.067	0.029	0.042	86786	0.258	0.040	0.158;
0.031	0.055	0.009	0.057	90288	0.269	0.022	0.128;
0.047	0.034	0.033	0.027	86983	0.274	0.033	0.270;
0.006	0.041	0.014	0.018	92595	0.316	0.045	0.201;
0.015	0.052	0.036	0.058	92591	0.178	0.035	0.261;
0.043	0.068	0.038	0.012	91851	0.201	0.048	0.161;
0.015	0.069	0.041	0.034	87396	0.230	0.031	0.250;
0.047	0.036	0.025	0.049	91362	0.175	0.047	0.191;
0.014	0.069	0.005	0.034	90265	0.252	0.028	0.269;
0.044	0.068	0.013	0.039	93800	0.199	0.045	0.129;
0.047	0.049	0.050	0.005	91279	0.170	0.048	0.186;
0.016	0.062	0.008	0.008	92457	0.263	0.031	0.207;
0.046	0.036	0.045	0.004	89761	0.206	0.021	0.177;
0.037	0.047	0.030	0.049	89594	0.204	0.044	0.114;
0.048	0.067	0.055	0.021	92651	0.123	0.040	0.111;
0.036	0.062	0.004	0.013	86879	0.192	0.044	0.142;
0.035	0.068	0.024	0.064	87266	0.237	0.034	0.266;
0.040	0.056	0.006	0.002	87579	0.308	0.029	0.252;
0.011	0.031	0.053	0.024	89271	0.107	0.029	0.192;
0.047	0.064	0.000	0.045	92698	0.311	0.049	0.179;
0.025	0.067	0.043	0.023	92480	0.221	0.041	0.164;
0.033	0.057	0.045	0.022	86700	0.240	0.031	0.191;
0.020	0.060	0.048	0.050	89336	0.178	0.049	0.227;
0.022	0.060	0.005	0.052	90329	0.336	0.027	0.184;
0.032	0.046	0.022	0.020	89473	0.108	0.049	0.171;
0.032	0.056	0.014	0.064	91340	0.226	0.036	0.102;
0.011	0.037	0.044	0.020	91116	0.163	0.046	0.120;
0.008	0.058	0.024	0.053	88502	0.115	0.038	0.152;
0.027	0.031	0.050	0.052	89588	0.289	0.044	0.188;
0.019	0.041	0.010	0.010	86350	0.330	0.030	0.117;
0.031	0.032	0.015	0.010	93886	0.206	0.028	0.145;
0.034	0.034	0.008	0.026	87531	0.154	0.029	0.197;
0.042	0.063	0.007	0.006	87056	0.300	0.046	0.238;
0.022	0.058	0.048	0.037	89127	0.119	0.049	0.221;
0.048	0.043	0.032	0.024	87771	0.199	0.036	0.232;
0.011	0.068	0.030	0.042	90040	0.256	0.031	0.124;
0.038	0.031	0.008	0.003	88871	0.252	0.038	0.128;
0.022	0.048	0.047	0.035	93634	0.233	0.025	0.140;
0.042	0.045	0.034	0.045	93390	0.239	0.023	0.116;
0.007	0.061	0.019	0.043	86640	0.328	0.041	0.236;
0.009	0.062	0.028	0.004	91971	0.172	0.038	0.220;
0.013	0.037	0.022	0.048	88324	0.141	0.039	0.267;
0.031	0.050	0.004	0.025	89520	0.278	0.050	0.227;
0.039	0.048	0.013	0.028	90492	0.239	0.046	0.253;
0.031	0.056	0.007	0.029	93564	0.116	0.037	0.242;
0.011	0.058	0.010	0.009	89480	0.207	0.037	0.163;
0.028	0.060	0.013	0.031	93878	0.209	0.038	0.142;
0.038	0.041	0.023	0.039	88575	0.276	0.048	0.106;
0.012	0.057	0.003	0.019	91685	0.104	0.032	0.213;
0.023	0.056	0.050	0.038	91414	0.310	0.045	0.148;
0.025	0.037	0.052	0.014	90424	0.162	0.037	0.120;
0.030	0.035	0.027	0.007	91661	0.218	0.049	0.212;
0.044	0.050	0.027	0.041	91416	0.224	0.036	0.188;
0.013	0.068	0.019	0.037	87616	0.136	0.037	0.122;
0.005	0.044	0.050	0.005	87226	0.174	0.036	0.149;
0.019	0.053	0.020	0.040	94003	0.113	0.028	0.205;
0.039	0.039	0.006	0.005	87561	0.152	0.050	0.141;
0.031	0.060	0.043	0.021	86484	0.243	0.040	0.246;
0.021	0.040	0.021	0.031	90596	0.107	0.040	0.232;
0.033	0.050	0.013	0.004	93091	0.212	0.046	0.159;
0.009	0.058	0.022	0.046	91436	0.166	0.039	0.112;
0.035	0.066	0.005	0.019	87712	0.216	0.040	0.110;
0.049	0.068	0.007	0.044	89100	0.284	0.049	0.182;
0.025	0.052	0.052	0.008	89814	0.298	0.030	0.212;
0.022	0.036	0.053	0.029	93867	0.159	0.021	0.218;
0.015	0.036	0.032	0.012	87447	0.209	0.041	0.250;
0.007	0.040	0.003	0.013	92886	0.292	0.042	0.261;
0.044	0.064	0.013	0.019	91246	0.148	0.036	0.168;
0.018	0.040	0.019	0.036	89157	0.226	0.033	0.219;
0.030	0.063	0.045	0.013	87715	0.222	0.026	0.115;
0.018	0.040	0.001	0.025	89562	0.172	0.047	0.167;
0.023	0.067	0.002	0.011	89980	0.276	0.049	0.180;
0.032	0.044	0.009	0.026	87168	0.125	0.043	0.136;
0.029	0.038	0.036	0.017	90816	0.275	0.028	0.259;
0.047	0.040	0.040	0.009	87990	0.159	0.021	0.104;
0.034	0.055	0.036	0.049	89222	0.234	0.050	0.212;
0.047	0.049	0.025	0.055	90766	0.268	0.043	0.247;
0.030	0.044	0.030	0.065	88189	0.174	0.025	0.133;
0.018	0.063	0.016	0.019	88490	0.180	0.039	0.170;
0.010	0.053	0.041	0.060	91031	0.119	0.026	0.108;
0.022	0.052	0.010	0.037	88294	0.321	0.031	0.215;
0.026	0.067	0.038	0.018	92644	0.280	0.042	0.165;
0.048	0.041	0.010	0.050	93875	0.212	0.050	0.126;
0.025	0.060	0.020	0.050	91911	0.145	0.038	0.204;
0.030	0.060	0.034	0.024	88905	0.278	0.035	0.180;
0.012	0.045	0.043	0.010	90774	0.338	0.025	0.193;
0.006	0.053	0.004	0.047	87068	0.314	0.023	0.129;
0.016	0.033	0.051	0.011	93281	0.276	0.039	0.123;
0.021	0.032	0.043	0.033	93074	0.113	0.025	0.118;
0.047	0.051	0.027	0.040	92592	0.115	0.047	0.122;
0.043	0.061	0.024	0.049	88258	0.214	0.027	0.160;
0.007	0.067	0.025	0.006	90854	0.168	0.048	0.109;
0.034	0.035	0.017	0.053	86405	0.103	0.036	0.200;
0.016	0.053	0.028	0.058	89539	0.159	0.049	0.194;
0.024	0.049	0.028	0.001	88663	0.215	0.035	0.187;
0.007	0.030	0.045	0.061	87486	0.320	0.036	0.179;
0.047	0.043	0.044	0.021	87621	0.289	0.023	0.218];
    
% Result vector (8,395 kg average yield loss for disc setting height 0.000)
target = [12.522; 7.859; 15.945; 11.535; 11.991; 7.732; 11.977; 10.643;
0.000; 9.089; 8.610; 10.067; 11.634; 6.870; 10.720; 3.550; 11.789; 22.537;
10.401; 8.202; 7.646; 8.369; 3.625; 11.278; 1.362; 7.477; 9.818; 11.511;
24.178; 22.020; 13.392; 8.101; 20.665; 11.007; 0.444; 1.463;10.486; 5.675; 
18.153; 4.166; 11.370; 15.297; 0.367; 7.525; 3.639; 0.394; 5.365; 2.320;
2.196; 3.967; 3.342; 2.583; 0.618; 14.317; 3.459; 7.780; 15.081; 8.781;
7.337; 8.073; 1.406; 5.857; 15.222; 21.226; 6.379; 2.937; 7.202; 8.181;
4.547; 2.135; 15.208; 0.814; 2.288; 2.145; 2.499; 12.178; 5.961; 1.692;
11.784; 8.084; 14.588; 1.041; 21.915; 11.499; 16.844; 19.371; 10.813;
7.409; 2.352; 8.099; 3.034; 0.789; 21.251; 4.965; 7.502; 4.320; 6.462;
9.009; 0.489; 10.048];

% Creating a neural network with 12 neurons in the hidden layer
hiddenLayerSize = 12;
net = feedforwardnet(hiddenLayerSize);

% Division of data into training, validation and test sets
net.divideParam.trainRatio = 60/100; % 60% of data for training
net.divideParam.valRatio = 20/100;   % 20% data for validation
net.divideParam.testRatio = 20/100;  % 20% danych do testowania

% % Neural network training
[net, tr] = train(net, X, Y);

% Display of yield loss information
disp('Carrot root yield losses.');
% Prediction of values for the test set
testX = X(:, tr.testInd);
testY = Y(tr.testInd);
testPredY = net(testX);

% Calculation of the mean square error (MSE) for a test set
testMSE = mse(testY, testPredY);

% Display of error
disp('Mean squared error (MSE) on the test set:');
disp(testMSE);
% % Visualisation of predicted and actual values
figure;
plot(testY, 'bo-', 'DisplayName', 'Real values');
hold on;
plot(testPredY, 'r*-', 'DisplayName', 'Predicted values');
legend;
xlabel('Trial index');
ylabel('Carrot root yield loss (kg)');
title('Comparison of real and predicted values');
grid on;

% % Error graph
errors = testY - testPredY;
figure;
bar(errors);
xlabel('Trial index');
ylabel('Error (kg)');
title('Prediction errors');
grid on;
% % Creating a neural network with a different activation function and number of neurons
hiddenLayerSize = [10 2]; % three hidden layers
net = feedforwardnet(hiddenLayerSize, 'trainlm'); %% we use the Levenberg-Marquardt function

% % Neural network training
[net, tr] = train(net, X, Y);

% % Prediction and evaluation as before
testX = X(:, tr.testInd);
testY = Y(tr.testInd);
testPredY = net(testX);
testMSE = mse(testY, testPredY);
disp('Mean squared error (MSE) on the test set');
disp(testMSE);
